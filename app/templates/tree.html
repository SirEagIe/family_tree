{% extends "base.html" %}

{% block head %}
    <script type="text/javascript" src="{{ url_for('static', filename='jquery-1.9.1.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='jquery-ui-1.10.2.custom.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='primitives.min.js') }}"></script>
    <link href="{{ url_for('static', filename='primitives.latest.css') }}" media="screen" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block content %}
    <!--
    <style>#draggable {cursor: help;}</style>
    <script>$(function() {$( "#draggable" ).draggable();});</script>
    -->
    <script type="text/javascript">
      var famdata = [
      {% for d in data %}
          {
            'id': {{d.id}},
            {% if d.parents %}'parents': {{ d.parents }},{% endif %}
            'title': "{{d.name}}",
            'description': "{{d.description}}" + " {{d.id}}",
            'image': "{{d.image}}"
          },
      {% endfor %}
      ];
      jQuery(document).ready(function () {
        var options = new primitives.orgdiagram.Config();
        options.items = famdata;
        options.cursorItem = null;
        options.hasSelectorCheckbox = primitives.common.Enabled.False;
        options.hasButtons = primitives.common.Enabled.False;
        options.pageFitMode = primitives.common.PageFitMode.PrintPreview;
        options.elbowType = primitives.common.ElbowType.Round;
        options.normalLevelShift = 20;
        options.dotLevelShift = 20;
        options.lineLevelShift = 24;
        options.normalItemsInterval = 10;
        options.dotItemsInterval = 1;
        options.lineItemsInterval = 1;
        options.linesWidth = 1;
        options.linesColor = "#7C8993";
        jQuery("#diagram").famDiagram(options);
        var placeholder = jQuery(".placeholder");
        jQuery("#diagram").css({
          width: placeholder.width() + 10,
          height: placeholder.height() + 10,
        })
        jQuery("#diagram").famDiagram("update");
      });
    </script>
    {{ data }}
    <div class="add-human-form" style="text-align: center; width: 70%; white-space: nowrap; display: none; z-index: 2; background-color: #fff; position: fixed; left: 50%; transform: translate(-50%, 0);">
      <form action="" method="post">
        {{ add_form.hidden_tag() }}
        <div class="" style="height: 200px; overflow: scroll; width: 50%; display: inline-block">
          <input type="text" class="first-search" placeholder="Поиск имен..">
          {{ add_form.first_parent(class_="fp") }}
        </div>
        <div class="" style="height: 200px; overflow: scroll; width: 50%; display: inline-block;">
          <input type="text" class="second-search" placeholder="Поиск имен..">
          {{ add_form.second_parent(class_="sp") }}
        </div>
        <br>
        {{ add_form.name.label }}
        {{ add_form.name }}
        <br>
        {{ add_form.description.label }}
        {{ add_form.description }}
        <br>
        {{ add_form.image.label }}
        {{ add_form.image }}
        <br>
        {{ add_form.submit() }}
      </form>
    </div>
    <div class="remove-human-form" style="text-align: center; width: 70%; white-space: nowrap; display: none; z-index: 2; background-color: #fff; position: fixed; left: 50%; transform: translate(-50%, 0);">
      <form action="" method="post">
        {{ remove_form.hidden_tag() }}
        <div class="" style="overflow: scroll; width: 50%; display: inline-block">
          <input type="text" class="remove-search" placeholder="Поиск имен..">
          {{ remove_form.id_human(class_="rm") }}
        </div>
        <br>
        {{ remove_form.submit() }}
      </form>
    </div>
    <div class="placeholder" style="width: 100%; height: 100vh; background-color: rgba(100, 100, 100, 0.5); position: fixed; z-index: 1; top: 0; left: 0; display: none;"></div>

    <button class="add-human">Add</button>
    <button class="remove-human">Remove</button>

    <script type="text/javascript">
      var add_button = document.querySelector(".add-human");
      var remove_button = document.querySelector(".remove-human");
      var placeholder = document.querySelector(".placeholder");
      var addHumanForm = document.querySelector(".add-human-form");
      var removeHumanForm = document.querySelector(".remove-human-form");
      add_button.onclick = function() {
        placeholder.style.display = "block";
        addHumanForm.style.display = "block";
      };
      remove_button.onclick = function() {
        placeholder.style.display = "block";
        removeHumanForm.style.display = "block";
      };
      placeholder.onclick = function() {
        placeholder.style.display = "none";
        addHumanForm.style.display = "none";
        removeHumanForm.style.display = "none";
      };
    </script>
    <script type="text/javascript">
      var firstSearch = document.querySelector('.first-search');
      var secondSearch = document.querySelector('.second-search');
      var removeSearch = document.querySelector('.remove-search');
      firstSearch.onkeyup = function() {
        var filter, ul, li, txtValue;
        filter = firstSearch.value.toUpperCase();
        ul = document.querySelector('.fp');
        li = document.querySelectorAll('.fp li');
        for (var i = 0; i < li.length; i++) {
          txtValue = li[i].textContent;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
          } else {
            li[i].style.display = "none";
          }
        }
      }
      secondSearch.onkeyup = function() {
        var filter, ul, li, txtValue;
        filter = secondSearch.value.toUpperCase();
        ul = document.querySelector('.sp');
        li = document.querySelectorAll('.sp li');
        for (var i = 0; i < li.length; i++) {
          txtValue = li[i].textContent;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
          } else {
            li[i].style.display = "none";
          }
        }
      }
      removeSearch.onkeyup = function() {
        var filter, ul, li, txtValue;
        filter = removeSearch.value.toUpperCase();
        ul = document.querySelector('.rm');
        li = document.querySelectorAll('.rm li');
        for (var i = 0; i < li.length; i++) {
          txtValue = li[i].textContent;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
          } else {
            li[i].style.display = "none";
          }
        }
      }
    </script>
    <div class="container">
      <div id="draggable" class="ui-widget-content ui-draggable">
        <div id="diagram" style="width:1000px; height:1000px"></div>
      </div>
    </div>
{% endblock %}
